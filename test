
import socket
import sys

# --- Socket Config (Listen on all network interfaces) ---
HOST = "0.0.0.0"  
PORT = 9999         

print("[Main Server] Starting up...")

try:
    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    server_socket.bind((HOST, PORT))
    server_socket.listen(1)

    print(f"\n[Main Server] SUCCESS. Brain is listening on {HOST}:{PORT}")
    print(">>> Waiting for the Vision Client (on your laptop) to connect...")

    while True:
        print("\n[Main Server] Waiting for a detection...")
        # It will wait here until your laptop connects
        conn, addr = server_socket.accept()

        with conn:
            print(f"[Main Server] Connection established with: {addr[0]}")
            data = conn.recv(1024)

            if data:
                category = data.decode('utf-8')

                # --- YOUR RASPBERRY PI LOGIC STARTS HERE ---
                print("="*30)
                print(f"  NEOARM BRAIN RECEIVED CATEGORY: '{category}'")
                print("="*30)

                # if category == "soft":
                #    run_soft_grip_command()
                # elif category == "hard":
                #    run_hard_grip_command()

except socket.error as e:
    print(f"\n[Main Server] ERROR: Could not start server. Error: {e}")
except KeyboardInterrupt:
    print("\n[Main Server] Shutting down.")
finally:
    if 'server_socket' in locals():
        server_socket.close()
        print("[Main Server] Socket closed.")
